<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Менеджер Ставок</title>
    <style>
        /* Общие стили */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #121212;
            color: white;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            touch-action: pan-y;
            overflow: hidden;
        }

        .container {
            max-width: 100%;
            width: 100%;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 0.8rem;
            min-height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        header {
            text-align: center;
            padding: 0.3rem 0;
        }

        h1 {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        p {
            font-size: 0.85rem;
            color: #ccc;
        }

        .input-group, .display-group {
            background-color: #1e1e1e;
            padding: 0.7rem;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .input-item, .display-item {
            display: flex;
            justify-content: space-between; /* Keeps elements spaced out */
            align-items: center;
            font-size: 0.9rem;
        }

        .input-item label, .display-item label {
            color: #ccc;
            flex-shrink: 0; /* Prevents label from shrinking */
            margin-right: 0.5rem; /* Space between label and input */
        }

        .input-item input[type="text"] {
            flex-grow: 1; /* Allows input to take available space */
            min-width: 0; /* Allows input to shrink properly on small screens */
            padding: 0.4rem;
            font-size: 0.9rem;
            text-align: center;
            background-color: #222;
            border: 1px solid #444;
            border-radius: 6px;
            color: white;
            caret-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            /* max-width removed here to allow more flexibility */
        }
        
        .display-item span {
            font-size: 1rem;
            font-weight: bold;
            color: #66bb6a;
        }
        .display-item span.loss {
            color: #ef5350;
        }

        .buttons-row {
            display: flex;
            gap: 0.6rem;
            width: 100%;
        }

        .buttons-row button {
            flex-grow: 1;
            padding: 0.7rem 0.5rem;
            font-size: 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .win-btn {
            background-color: #4CAF50;
            color: white;
        }
        .win-btn:hover {
            background-color: #45a049;
        }

        .lose-btn {
            background-color: #f44336;
            color: white;
        }
        .lose-btn:hover {
            background-color: #d32f2f;
        }

        #resetBtn {
            margin-top: 0.5rem;
            padding: 0.7rem 0.5rem;
            font-size: 0.95rem;
            background-color: #607d8b;
            color: white;
            border: none;
            border-radius: 66px;
            cursor: pointer;
            transition: background 0.3s ease;
            width: 100%;
        }
        #resetBtn:hover {
            background-color: #455a64;
        }

        /* Кастомная числовая клавиатура */
        #custom-keyboard {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #282828;
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.5);
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }

        #custom-keyboard.visible {
            transform: translateY(0);
        }

        #custom-keyboard button {
            width: 100%;
            padding: 15px 0;
            font-size: 1.5rem;
            background-color: #3a3a3a;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            -webkit-user-select: none;
            user-select: none;
        }

        #custom-keyboard button:hover {
            background-color: #4f4f4f;
        }

        #custom-keyboard button.delete-key {
            background-color: #dc3545;
        }

        #custom-keyboard button.delete-key:hover {
            background-color: #c82333;
        }

        #custom-keyboard button.empty-key {
            background-color: transparent;
            cursor: default;
            pointer-events: none;
        }
        
        body.keyboard-active .container {
            padding-bottom: 220px;
        }

        /* Warning message */
        .warning-message {
            background-color: #ffeb3b;
            color: #333;
            padding: 0.7rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            line-height: 1.3;
            font-weight: 500;
            border-left: 5px solid #ff9800;
        }

        /* Медиа-запросы для узких экранов (смартфоны и планшеты в портрете) */
        @media (max-width: 768px) {
            .container {
                padding: 0.3rem;
                gap: 0.5rem;
            }

            header {
                padding: 0.2rem 0;
            }

            h1 {
                font-size: 1rem;
            }

            p {
                font-size: 0.75rem;
            }

            .warning-message {
                padding: 0.5rem;
                font-size: 0.7rem;
            }

            .input-group, .display-group {
                padding: 0.5rem;
                gap: 0.4rem;
            }

            .input-item, .display-item {
                font-size: 0.8rem;
            }

            .input-item label, .display-item label {
                font-size: 0.75rem;
                margin-right: 0.3rem; /* Slightly reduced margin */
            }

            .input-item input[type="text"] {
                padding: 0.3rem;
                font-size: 0.8rem;
                /* max-width removed */
            }

            .display-item span {
                font-size: 0.9rem;
            }

            .buttons-row {
                gap: 0.4rem;
            }

            .buttons-row button {
                padding: 0.6rem 0.4rem;
                font-size: 0.9rem;
            }

            #resetBtn {
                margin-top: 0.4rem;
                padding: 0.6rem 0.4rem;
                font-size: 0.85rem;
            }

            body.keyboard-active .container {
                padding-bottom: 220px;
            }
        }

        /* Медиа-запросы для альбомной ориентации iPad и других планшетов (ширина больше высоты) */
        @media (orientation: landscape) and (max-height: 768px) {
            .container {
                gap: 0.4rem;
                padding: 0.3rem;
            }
            h1 { font-size: 0.95rem; }
            p { font-size: 0.7rem; }
            .warning-message { font-size: 0.65rem; padding: 0.4rem; }
            .input-item label, .display-item label { font-size: 0.75rem; margin-right: 0.2rem; } /* Further reduced margin */
            .input-item input, .display-item span { font-size: 0.8rem; padding: 0.25rem; }
            .buttons-row button, #resetBtn { font-size: 0.8rem; padding: 0.5rem; }

            body.keyboard-active .container {
                padding-bottom: 170px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Менеджер Ставок (Процентный Флэт)</h1>
            <p>Управляйте своим банкроллом эффективно.</p>
        </header>

        <div class="warning-message">
            <p><strong>Важное примечание:</strong> При коэффициенте 1.30, чтобы быть в долгосрочном плюсе, ваша проходимость должна быть выше 77% ($1 / 1.30 \approx 0.769$). При заявленных 60-70% проходимости эта стратегия будет убыточной на длинной дистанции. Программа поможет управлять убытками, но не сделает минусовую стратегию плюсовой.</p>
        </div>

        <div class="input-group">
            <div class="input-item">
                <label for="initialBankroll">Начальный банкролл:</label>
                <input type="text" id="initialBankroll" inputmode="none" value="1000" readonly>
            </div>
            <div class="input-item">
                <label for="betPercentage">Процент от банкролла на ставку (%):</label>
                <input type="text" id="betPercentage" inputmode="none" value="2" readonly>
            </div>
            <div class="input-item">
                <label for="odds">Коэффициент ставки:</label>
                <input type="text" id="odds" inputmode="none" value="1.30" readonly>
            </div>
        </div>

        <div class="display-group">
            <div class="display-item">
                <label>Текущий банкролл:</label>
                <span id="currentBankrollDisplay">0.00</span>
            </div>
            <div class="display-item">
                <label>Размер следующей ставки:</label>
                <span id="nextBetSizeDisplay">0.00</span>
            </div>
            <div class="display-item">
                <label>Общая прибыль/убыток:</label>
                <span id="totalProfitLossDisplay" class="loss">0.00</span>
            </div>
        </div>

        <div class="buttons-row">
            <button class="win-btn" id="winBtn">Выиграла</button>
            <button class="lose-btn" id="loseBtn">Проиграла</button>
        </div>

        <button id="resetBtn">Сбросить данные</button>
    </div>

    <div id="custom-keyboard">
        <button data-key="1">1</button>
        <button data-key="2">2</button>
        <button data-key="3">3</button>
        <button data-key="4">4</button>
        <button data-key="5">5</button>
        <button data-key="6">6</button>
        <button data-key="7">7</button>
        <button data-key="8">8</button>
        <button data-key="9">9</button>
        <button data-key=".">.</button>
        <button data-key="0">0</button>
        <button data-key="delete" class="delete-key">⌫</button>
    </div>

    <script>
        const MIN_BET = 10; // Минимальная ставка в рублях

        document.addEventListener("DOMContentLoaded", () => {
            const initialBankrollInput = document.getElementById("initialBankroll");
            const betPercentageInput = document.getElementById("betPercentage");
            const oddsInput = document.getElementById("odds");

            const currentBankrollDisplay = document.getElementById("currentBankrollDisplay");
            const nextBetSizeDisplay = document.getElementById("nextBetSizeDisplay");
            const totalProfitLossDisplay = document.getElementById("totalProfitLossDisplay");

            const winBtn = document.getElementById("winBtn");
            const loseBtn = document.getElementById("loseBtn");
            const resetBtn = document.getElementById("resetBtn");

            const customKeyboard = document.getElementById("custom-keyboard");
            const keyboardButtons = customKeyboard.querySelectorAll("button");

            let activeInput = null;
            let initialBankroll = parseFloat(initialBankrollInput.value);
            let currentBankroll = initialBankroll;
            let betPercentage = parseFloat(betPercentageInput.value);
            let odds = parseFloat(oddsInput.value);

            // Function to format numbers (e.g., 1234.5 to 1,234.50 or just 1234.5)
            const formatNumber = (num) => {
                if (!isFinite(num)) {
                    return 'Ошибка';
                }
                return num.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            };

            const calculateNextBetSize = () => {
                let calculatedSize = currentBankroll * (betPercentage / 100);
                
                if (currentBankroll <= 0) {
                    return 0; // If bankroll is zero or negative, no bet
                }

                // Apply minimum bet rule
                if (calculatedSize < MIN_BET) {
                    calculatedSize = MIN_BET;
                }

                // Ensure bet does not exceed current bankroll
                if (calculatedSize > currentBankroll) {
                    calculatedSize = currentBankroll;
                }
                return calculatedSize;
            };

            const updateDisplays = () => {
                let nextBetSize = calculateNextBetSize();
                let totalProfitLoss = currentBankroll - initialBankroll;

                currentBankrollDisplay.textContent = formatNumber(currentBankroll);
                nextBetSizeDisplay.textContent = formatNumber(nextBetSize);
                totalProfitLossDisplay.textContent = formatNumber(totalProfitLoss);

                if (totalProfitLoss >= 0) {
                    totalProfitLossDisplay.classList.remove("loss");
                    totalProfitLossDisplay.classList.add("profit");
                } else {
                    totalProfitLossDisplay.classList.remove("profit");
                    totalProfitLossDisplay.classList.add("loss");
                }
            };

            const resetData = () => {
                initialBankroll = parseFloat(initialBankrollInput.value.replace(',', '.')) || 0;
                betPercentage = parseFloat(betPercentageInput.value.replace(',', '.')) || 0;
                odds = parseFloat(oddsInput.value.replace(',', '.')) || 0;

                currentBankroll = initialBankroll;
                updateDisplays();
                hideKeyboard();
            };

            const hideKeyboard = () => {
                customKeyboard.classList.remove("visible");
                document.body.classList.remove("keyboard-active");
                if (activeInput) {
                    activeInput.blur();
                }
                activeInput = null;
            };

            // Initial setup
            updateDisplays();

            // Event Listeners for inputs
            [initialBankrollInput, betPercentageInput, oddsInput].forEach(input => {
                input.setAttribute('inputmode', 'none');
                input.setAttribute('readonly', 'readonly');
                input.setAttribute('autocomplete', 'off');

                input.addEventListener("focus", () => {
                    activeInput = input;
                    customKeyboard.classList.add("visible");
                    document.body.classList.add("keyboard-active");
                    setTimeout(() => {
                        activeInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 300);
                });

                input.addEventListener("click", (e) => {
                    e.preventDefault();
                    activeInput = input;
                    customKeyboard.classList.add("visible");
                    document.body.classList.add("keyboard-active");
                    activeInput.focus();
                });

                input.addEventListener("input", () => {
                    const parsedValue = parseFloat(input.value.replace(',', '.'));
                    if (input.id === "initialBankroll") {
                        initialBankroll = parsedValue || 0;
                        // When initial bankroll changes, current bankroll also resets to this new initial value
                        currentBankroll = initialBankroll; 
                    } else if (input.id === "betPercentage") {
                        betPercentage = parsedValue || 0;
                    } else if (input.id === "odds") {
                        odds = parsedValue || 0;
                    }
                    updateDisplays();
                });
            });

            // Keyboard button click handler
            keyboardButtons.forEach(button => {
                button.addEventListener("click", (e) => {
                    e.preventDefault();
                    if (!activeInput) return;

                    const key = button.dataset.key;
                    let currentValue = activeInput.value;

                    if (key === "delete") {
                        activeInput.value = currentValue.slice(0, -1);
                    } else if (key === ".") {
                        if (!currentValue.includes(',') && !currentValue.includes('.')) {
                            if (currentValue.length === 0) {
                                activeInput.value = "0,";
                            } else {
                                activeInput.value += ",";
                            }
                        }
                    } else {
                        const maxInputLength = (activeInput.id === "initialBankroll") ? 10 : 5;
                        if (currentValue.length < maxInputLength) {
                            const parts = currentValue.split(',');
                            if (parts.length === 1) {
                                activeInput.value += key;
                            } else if (parts.length === 2 && parts[1].length < 2) {
                                activeInput.value += key;
                            }
                        }
                    }
                    activeInput.dispatchEvent(new Event('input'));
                });
            });

            // Win/Lose button handlers
            winBtn.addEventListener("click", () => {
                if (currentBankroll <= 0) {
                    alert("Банкролл равен нулю. Сбросьте данные для начала новой сессии.");
                    return;
                }
                const betAmount = calculateNextBetSize(); // Use the same calculation for actual bet
                
                if (betAmount <= 0) { // Should not happen if currentBankroll > 0 due to MIN_BET, but good check
                    alert("Невозможно сделать ставку. Проверьте банкролл.");
                    return;
                }
                
                currentBankroll += (betAmount * (odds - 1));
                updateDisplays();
                hideKeyboard();
            });

            loseBtn.addEventListener("click", () => {
                if (currentBankroll <= 0) {
                    alert("Банкролл равен нулю. Сбросьте данные для начала новой сессии.");
                    return;
                }
                const betAmount = calculateNextBetSize(); // Use the same calculation for actual bet

                if (betAmount <= 0) { // Should not happen if currentBankroll > 0 due to MIN_BET, but good check
                    alert("Невозможно сделать ставку. Проверьте банкролл.");
                    return;
                }

                currentBankroll -= betAmount;
                if (currentBankroll < 0) currentBankroll = 0;
                updateDisplays();
                hideKeyboard();
            });

            resetBtn.addEventListener("click", resetData);

            document.addEventListener('click', (event) => {
                if (customKeyboard.classList.contains('visible') && activeInput) {
                    const isClickInsideKeyboard = customKeyboard.contains(event.target);
                    const isClickOnInput = activeInput.contains(event.target);
                    const isClickOnBetButton = winBtn.contains(event.target) || loseBtn.contains(event.target);
                    const isClickOnResetButton = resetBtn.contains(event.target);

                    if (!isClickInsideKeyboard && !isClickOnInput && !isClickOnBetButton && !isClickOnResetButton) {
                        hideKeyboard();
                    }
                }
            });
        });
    </script>
</body>
</html>
